#!/bin/sh

readonly DDC_BRIGHTNESS_CODE=10

main()
{
  if ! command -v ddcutil > /dev/null; then
    printf -- 'Must install "ddcutil"\n'
    return 1
  fi

  cmd="$1"
  if [ -z "${cmd}" ]; then
    printf -- 'Must pass command "get" or "set"\n'
    return 1
  fi

  shift

  if [ "${cmd}" = "get" ]; then
    sudo ddcutil getvcp "${DDC_BRIGHTNESS_CODE}" || return 1
  elif [ "${cmd}" = "set" ]; then
    amount="$1"

    if [ -z "${amount}" ]; then
      printf -- 'Must provide amount for brightness between 0 and 100\n'
      return 1
    fi

    sudo ddcutil setvcp "${DDC_BRIGHTNESS_CODE}" "${amount}" || return 1
  else
    printf -- 'Must pass command "get" or "set"\n'
  fi

  unset cmd
  unset amount
  return 0
}

main "$@" || exit 1
exit 0
