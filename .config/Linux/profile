# shellcheck shell=bash

__setup_sdl() {
  # Do not set the SDL_AUDIODRIVER option as it causes weird Steam issues
  export SDL_AUDIODRIVER=
  unset SDL_AUDIODRIVER

  # Do not set the SDL_VIDEODRIVER option as it causes weird Steam issues
  export SDL_VIDEODRIVER=
  unset SDL_VIDEODRIVER
}

__setup_gpu() {
  # Hardware Accel
  #
  # For AMD
  export LIBVA_DRIVER_NAME=radeonsi

  # Use single-file shader cache
  # https://www.phoronix.com/news/Mesa-Single-File-Cache
  export MESA_DISK_CACHE_SINGLE_FILE=1
}

__setup_audio() {
  # Help with Pulse audio crackling in some programs
  export PULSE_LATENCY_MSEC=60
}

__setup_accessibility() {
  # No AT accessibility bus
  export NO_AT_BRIDGE=1
}

__xprofile() {
  # shellcheck disable=SC1091
  [ -f "${HOME}"/.bash_profile ] && . "${HOME}"/.bash_profile

  __setup_gpu
  __setup_sdl
  __setup_audio
  __setup_accessibility

  # Run startup programs
  _cfg="${XDG_CONFIG_HOME:-${HOME}/.config}"
  # shellcheck disable=SC1091
  [ -f "${_cfg}/Linux/startup" ] && . "${_cfg}/Linux/startup" &
  unset _cfg
}

__xprofile

unset -f __xprofile
unset -f __setup_gpu
unset -f __setup_sdl
unset -f __setup_audio
unset -f __setup_accessibility
