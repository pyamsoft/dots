#!/bin/sh
_root="${HOME}/.docker/app/adguardhome"
_work="${_root}/work"
_conf="${_root}/conf"

prepare_dirs()
{
  mkdir -p "${_work}" || return 1
  mkdir -p "${_conf}" || return 2
  return 0
}

prepare_dirs || {
  printf -- 'Could not setup docker directories.\n'
  exit 1
}

# https://hub.docker.com/r/adguard/adguardhome
#
# Always restart unless we kill it explicitly
# Bind work and conf directories
#
# Always bind port 53 for DNS queries
# Bind port 81 and 3000 for admin console
# Run as daemon
exec docker run \
  --restart unless-stopped \
  -v "${_work}":/opt/adguardhome/work \
  -v "${_conf}":/opt/adguardhome/conf \
  -p 53:53/tcp \
  -p 53:53/udp \
  -p 81:81/tcp \
  -d adguard/adguardhome
