#!/bin/sh

# Source our common library
. "/opt/pyamsoft/lib/container-launch"

NAME="rendercv"
IMAGE="ghcr.io/rendercv/rendercv"
TAG="v2.6"

_prep_mounts() {
  _mount_bind "${CONTAINER_RUNTIME_DIR}/${NAME}/work" "/work" || return 1

  return 0
}

_prep_env() {
  return 0
}

_prep_network() {
  _network_isolate || return 1
  return 0
}

_prep_caps() {
  _add_caps --cap-add DAC_OVERRIDE
  return 0
}

_prep_ports() {
  return 0
}

_check_user() {
  _require_nonroot || return 1

  # Export files as current user
  _add_userns --user "$(id -u):$(id -g)"

  if _is_podman; then
    _add_userns --userns keep-id
  fi

  return 0
}

_finalize() {
  _add_rc --workdir="/work"
  return 0
}

main "$@" || exit 1
exit 0
