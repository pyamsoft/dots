#!/bin/sh

# Source our common library
. "/opt/pyamsoft/lib/container-launch"

NAME="littlelink"
IMAGE="ghcr.io/techno-tim/littlelink-server"
TAG="latest"

CONTAINER_REQUIRE_INIT=1
CONTAINER_PULL_POLICY="newer"

_prep_mounts() {
  _mount_mkdir "${CONTAINER_RUNTIME_DIR}/${NAME}/data" || return 1

  return 0
}

_prep_env() {
  _add_env -e META_INDEX_STATUS=noindex
  _add_env -e LANG=en
  _add_env -e THEME=Dark
  _add_env -e THEME_OS=true

  return 0
}

_prep_network() {
  # Attach our isolated network
  #
  # We shouldn't need to care about source IP addresses here as this website is proxied through Cloudflare
  # so their protections should generally handle it. Plus there are no specific log drivers in Crowdsec that
  # need to read these logs to identify bad actors.
  _network_isolate || return 1

  return 0
}

_prep_caps() {
  return 0
}

_prep_ports() {
  _add_ports -p "127.0.0.1:8420:3000/tcp"
  return 0
}

_check_user() {
  _require_nonroot || return 1

  return 0
}

main "$@" || exit 1
exit 0
