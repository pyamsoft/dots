#!/bin/sh

# Source our common library
. "/opt/pyamsoft/lib/container-launch"

NAME="ddns"
IMAGE="docker.io/favonia/cloudflare-ddns"
TAG="1.15.1"

# IPv6 support
CONTAINER_NETWORK_IP6=1

_prep_mounts() {
  return 0
}

_prep_caps() {
  return 0
}

_prep_ports() {
  return 0
}

_check_user() {
  _require_nonroot || return 1

  CONTAINER_USERNS="${CONTAINER_USERNS} --user $(id -u):$(id -g)"

  return 0
}

_prep_env() {
  # Cloudflare owns our records
  CONTAINER_ENV="${CONTAINER_ENV} -e PROXIED=true"
  return 0
}

_prep_network() {
  _network_isolate || return 1
  return 0
}

main "$@" || exit 1
exit 0
