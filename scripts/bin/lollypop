#!/bin/sh

kill_portal()
{
  lollypop_pid="$(running lollypop-portal | awk '{print $2}')"
  if [ -n "${lollypop_pid}" ]; then
    kill "${lollypop_pid}" || {
      echo "Failed to kill lollypop portal: ${lollypop_pid}"
    }
  fi

  unset lollypop_pid
}

run_lollypop()
{
  # cache for album art
  bww \
    --dconf \
    --bind-if-exists "${HOME}/.cache" \
    --bind-if-exists "${HOME}/music" \
    lollypop "$@"
}

main()
{
  trap kill_portal INT TERM

  run_lollypop "$@"
  kill_portal

  return 0
}

main "$@" || exit 1
exit 0
