#!/bin/sh

main()
{
  printf -- 'Stopping old sunshine service...\n'
  systemctl --user stop sunshine > /dev/null 2>&1

  # Kill any potentially symlinks
  printf -- 'Remove old sunshine devices...\n'
  rm -f "${HOME}/.config/sunshine/sunshine_keyboard" > /dev/null 2>&1
  rm -f "${HOME}/.config/sunshine/sunshine_mouse" > /dev/null 2>&1
  rm -f "${HOME}/.config/sunshine/sunshine_touchscreen" > /dev/null 2>&1

  # For some reason, sunshine spawns an extra firewall-applet, so kill them all here first
  printf -- 'Kill firewall-applet to remove duplicate tray icons...\n'
  killall firewall-applet > /dev/null 2>&1

  printf -- 'Starting new sunshine service...\n'
  systemctl --user restart sunshine > /dev/null 2>&1
  return 0
}

if command -v sunshine > /dev/null 2>&1; then
  main "$@" || exit 1
  exit 0
else
  printf -- 'sunshine is not installed.\n'
  exit 1
fi
