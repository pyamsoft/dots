#!/bin/sh

dots_cmd()
{
  case "$1" in
    init)
      git init --bare "${HOME}/.dotfiles" || return 1
      ;;
    clone)
      git clone --bare "$2" "${HOME}/.dotfiles" || return 1
      ;;
    *)
      git --git-dir="${HOME}/.dotfiles" --work-tree="${HOME}" "$@" || return 1
      ;;
  esac

  return 0
}

dots()
{
  dots_cmd "$@" || return 1
  dots_cmd config --local status.showUntrackedFiles no || return 1
  dots_cmd config --local core.excludesFile "${HOME}/.dotignore" || return 1
  if [ ! -e "${HOME}/.dotignore" ]; then
    printf -- '%s\n' ".dotignore" > "${HOME}/.dotignore" || return 1
  fi

  return 0
}

dots "$@" || exit 1
exit 0
