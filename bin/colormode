#!/bin/sh

if [ -z "$1" ]; then
  printf -- 'Must provide either "light" or "dark" mode\n'
  exit 1
fi

if [ "$1" = "light" ] || [ "$1" = "l" ]; then
  if [ "$(uname)" = "Darwin" ]; then
    # MacOS sed is BSD
    sed -i '' 's/catppuccin-mocha/catppuccin-latte/' ~/.config/lvim/config.lua
    sed -i '' 's/@catppuccin_flavour "mocha"/@catppuccin_flavour "latte"/' ~/.config/tmux/tmux.conf

    # https://apple.stackexchange.com/questions/437581/toggle-system-dark-mode-from-terminal
    osascript -e 'tell app "System Events" to tell appearance preferences to set dark mode to not dark mode'
  else
    # Linux is GNU sed
    sed -i '0,/catppuccin-mocha/s//catppuccin-latte/' ~/.config/lvim/config.lua
    sed -i '0,/@catppuccin_flavour "mocha"/s//@catppuccin_flavour "latte"/' ~/.config/tmux/tmux.conf

    # XFCE4 terminal
    sed -i '0,/^ColorForeground=.*$/s//ColorForeground=#4C4F69/' ~/.config/xfce4/terminal/terminalrc
    sed -i '0,/^ColorBackground=.*$/s//ColorBackground=#EFF1F5/' ~/.config/xfce4/terminal/terminalrc
    sed -i '0,/^ColorCursorForeground=.*$/s//ColorCursorForeground=#EFF1F5/' ~/.config/xfce4/terminal/terminalrc
    sed -i '0,/^ColorCursorBackground=.*$/s//ColorCursorBackground=#ACB0BE/' ~/.config/xfce4/terminal/terminalrc
    sed -i '0,/^ColorSelection=.*$/s//ColorSelection=#4C4F69/' ~/.config/xfce4/terminal/terminalrc
    sed -i '0,/^ColorSelectionBackground=.*$/s//ColorSelectionBackground=#ACB0BE/' ~/.config/xfce4/terminal/terminalrc
    sed -i '0,/^TabActivityColor=.*$/s//TabActivityColor=#FE640B/' ~/.config/xfce4/terminal/terminalrc
    sed -i '0,/^ColorPalette=.*$/s//ColorPalette=#5C5F77;#D20F39;#40A02B;#DF8E1D;#1E66F5;#EA76CB;#179299;#ACB0BE;#6C6F85;#D20F39;#40A02B;#DF8E1D;#1E66F5;#EA76CB;#179299;#BCC0CC/' ~/.config/xfce4/terminal/terminalrc

    # GNOME Desktop
    gsettings set org.gnome.desktop.interface gtk-theme "Adwaita"    # GTK-3
    gsettings set org.gnome.desktop.interface color-scheme "default" # GTK-4
  fi
elif [ "$1" = "dark" ] || [ "$1" = "d" ]; then
  if [ "$(uname)" = "Darwin" ]; then
    # MacOS sed is BSD
    sed -i '' 's/catppuccin-latte/catppuccin-mocha/' ~/.config/lvim/config.lua
    sed -i '' 's/@catppuccin_flavour "latte"/@catppuccin_flavour "mocha"/' ~/.config/tmux/tmux.conf

    # https://apple.stackexchange.com/questions/437581/toggle-system-dark-mode-from-terminal
    osascript -e 'tell app "System Events" to tell appearance preferences to set dark mode to dark mode'
  else
    # Linux is GNU sed
    sed -i '0,/catppuccin-latte/s//catppuccin-mocha/' ~/.config/lvim/config.lua
    sed -i '0,/@catppuccin_flavour "latte"/s//@catppuccin_flavour "mocha"/' ~/.config/tmux/tmux.conf

    # XFCE4 terminal
    sed -i '0,/^ColorForeground=.*$/s//ColorForeground=#CDD6F4/' ~/.config/xfce4/terminal/terminalrc
    sed -i '0,/^ColorBackground=.*$/s//ColorBackground=#1E1E2E/' ~/.config/xfce4/terminal/terminalrc
    sed -i '0,/^ColorCursorForeground=.*$/s//ColorCursorForeground=#11111B/' ~/.config/xfce4/terminal/terminalrc
    sed -i '0,/^ColorCursorBackground=.*$/s//ColorCursorBackground=#585B70/' ~/.config/xfce4/terminal/terminalrc
    sed -i '0,/^ColorSelection=.*$/s//ColorSelection=#CDD6F4/' ~/.config/xfce4/terminal/terminalrc
    sed -i '0,/^ColorSelectionBackground=.*$/s//ColorSelectionBackground=#585B70/' ~/.config/xfce4/terminal/terminalrc
    sed -i '0,/^TabActivityColor=.*$/s//TabActivityColor=#FAB387/' ~/.config/xfce4/terminal/terminalrc
    sed -i '0,/^ColorPalette=.*$/s//ColorPalette=#45475A;#F38BA8;#A6E3A1;#F9E2AF;#89B4FA;#F5C2E7;#94E2D5;#BAC2DE;#585B70;#F38BA8;#A6E3A1;#F9E2AF;#89B4FA;#F5C2E7;#94E2D5;#A6ADC8/' ~/.config/xfce4/terminal/terminalrc

    # GNOME Desktop
    gsettings set org.gnome.desktop.interface gtk-theme "Adwaita-dark"   # GTK-3
    gsettings set org.gnome.desktop.interface color-scheme "prefer-dark" # GTK-4
  fi
else
  printf -- 'Must provide either "light" or "dark" mode\n'
  exit 1
fi

# Re-source tmux
tmux source-file ~/.config/tmux/tmux.conf
