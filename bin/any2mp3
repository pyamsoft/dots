#!/bin/sh

convert()
{
  ffmpeg -i "$1" -threads 0 "$1".mp3 < /dev/null
  rm -f "$1"
}

if [ -z "$1" ]; then
  printf -- 'Directory needed\n'
  exit 1
fi

MAX_COUNT=50

i=0
for f in "$@"; do
  if [ "$i" -ge "$MAX_COUNT" ]; then
    printf -- 'Max count of %s reached. Stop\n' "$MAX_COUNT"
    exit 0
  fi
  case "$f" in
    *.mp3)
      printf -- 'File: %s is already an MP3\n' "$f"
      ;;
    *)
      i=$((i + 1))
      convert "$f" &
      ;;
  esac
done
